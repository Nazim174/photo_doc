# üåê –†–∞–±–æ—Ç—è–≥–∏ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ YooMoney - –§–∏–Ω–∞–ª—å–Ω—ã–π –≥–∞–π–¥

## üéØ –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ —Ä–∞–±–æ—á–∏–µ URI –≤–∞—Ä–∏–∞–Ω—Ç—ã

### üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º

–ü–æ—Å–ª–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —è –≤—ã—è–≤–∏–ª —Å–ª–µ–¥—É—é—â–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–æ–∫:

1. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** - `YOOMONEY_CLIENT_ID`, `YOOMONEY_REDIRECT_URI`
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ URI —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** - –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –≤–º–µ—Å—Ç–æ —Ä–∞–±–æ—á–∏—Ö URL
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å –≤–µ–±—Ö—É–∫–∞–º–∏** - –æ–±—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
4. **–î–æ–º–µ–Ω–Ω–∞—è –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** - —Ä–∞–∑–Ω—ã–µ –¥–æ–º–µ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ URI

---

## ‚úÖ –†–ê–ë–û–ß–ò–ï –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ï –ó–ù–ê–ß–ï–ù–ò–Ø

### üöÄ **–ü–õ–ê–ù A: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**
```
–ê–¥—Ä–µ—Å —Å–∞–π—Ç–∞:        http://localhost:3000
Redirect URI:       http://localhost:3000/callback
Notification URI:   https://your-ngrok-url.ngrok.io/webhooks/yoomoney
```

### üåç **–ü–õ–ê–ù B: –í–Ω–µ—à–Ω–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (ngrok)**
```
–ê–¥—Ä–µ—Å —Å–∞–π—Ç–∞:        https://abc123.ngrok.io
Redirect URI:       https://abc123.ngrok.io/callback
Notification URI:   https://abc123.ngrok.io/webhooks/yoomoney
```

### ‚ö° **–ü–õ–ê–ù C: Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**
```
–ê–¥—Ä–µ—Å —Å–∞–π—Ç–∞:        https://your-production-domain.com
Redirect URI:       https://your-production-domain.com/auth/callback
Notification URI:   https://your-production-domain.com/webhooks/yoomoney
```

---

## üéØ –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏—á–∏–Ω –æ—à–∏–±–æ–∫
‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–æ** - –ü—Ä–æ–±–ª–µ–º—ã:
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `YOOMONEY_CLIENT_ID` –≤ –∫–æ–Ω—Ñ–∏–≥–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ –≤–º–µ—Å—Ç–æ —Ä–∞–±–æ—á–∏—Ö URL
- –û–±—â–∏–π webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –±–µ–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ YooMoney

### –®–ê–ì 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ –ø–ª–∞–Ω–∞–º

#### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ü–ª–∞–Ω A):
```bash
echo "YOOMONEY_CLIENT_ID=–≤–∞—à_client_id" >> .env
echo "YOOMONEY_REDIRECT_URI=http://localhost:3000/callback" >> .env
echo "SERVER_URL=http://localhost:3000" >> .env
```

#### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å ngrok (–ü–ª–∞–Ω B):
```bash
echo "YOOMONEY_NGROK_SERVER_URL=https://abc123.ngrok.io" >> .env
echo "YOOMONEY_NGROK_REDIRECT_URI=https://abc123.ngrok.io/callback" >> .env
```

#### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (–ü–ª–∞–Ω C):
```bash
echo "YOOMONEY_PROD_SERVER_URL=https://your-domain.com" >> .env
echo "YOOMONEY_PROD_REDIRECT_URI=https://your-domain.com/auth/callback" >> .env
```

### –®–ê–ì 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤

–í–∞—à webhook endpoint –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
- **URL**: `/webhooks/yoomoney`
- **–ú–µ—Ç–æ–¥**: POST
- **–ó–∞–≥–æ–ª–æ–≤–∫–∏**: `Content-Type: application/x-www-form-urlencoded`

### –®–ê–ì 4: –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:
```bash
node yoomoney_final_test.js
```

–í—Å–µ –ø–ª–∞–Ω—ã –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å **7-8/10 –±–∞–ª–ª–æ–≤** —Å —Å—Ç–∞—Ç—É—Å–æ–º "‚úÖ –•–æ—Ä–æ—à–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –≤–µ–±—Ö—É–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
–î–æ–±–∞–≤–ª–µ–Ω –≤ `src/server/routes/webhooks.js`:
```javascript
// –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π endpoint –¥–ª—è YooMoney
router.post('/yoomoney', (req, res) => {
    const result = handleWebhook(req.body, 'yoomoney');
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
});
```

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
–û–±–Ω–æ–≤–ª–µ–Ω `.env` —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
```
# –û—Å–Ω–æ–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
YOOMONEY_CLIENT_ID=your_client_id
YOOMONEY_REDIRECT_URI=https://your-domain.com/callback

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–ª–∞–Ω—ã
YOOMONEY_ALT_SERVER_URL=http://localhost:3000      # –ü–ª–∞–Ω A
YOOMONEY_NGROK_SERVER_URL=https://abc123.ngrok.io  # –ü–ª–∞–Ω B
YOOMONEY_PROD_SERVER_URL=https://your-domain.com   # –ü–ª–∞–Ω C
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π

–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `yoomoney_final_test.js` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

```bash
# –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–ª–∞–Ω–æ–≤
node yoomoney_final_test.js

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö URI
node alternative_uris_test.js
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- **–ü–ª–∞–Ω A**: 7/10 ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê - –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- **–ü–ª–∞–Ω B**: 8/10 ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê - –í–Ω–µ—à–Ω–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ü–ª–∞–Ω C**: 8/10 ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê - Production

---

## üì± –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è YooMoney:

1. **–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ YooMoney**:
   - –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Redirect URI: `https://your-domain.com/callback`

2. **–í –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**:
```javascript
// –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
const redirectUri = process.env.YOOMONEY_REDIRECT_URI;
const clientId = process.env.YOOMONEY_CLIENT_ID;

// –î–ª—è webhooks
const notificationUrl = `${process.env.SERVER_URL}/webhooks/yoomoney`;
```

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π**:
```bash
npm test -- --testNamePattern="YooMoney"
```

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø–æ –ø–ª–∞–Ω–∞–º

### üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç - –ü–ª–∞–Ω A (–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ .env
export YOOMONEY_CLIENT_ID="–≤–∞—à_client_id"
export YOOMONEY_REDIRECT_URI="http://localhost:3000/callback"

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
npm start

# –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–ª–∞—Ç–µ–∂–∏
curl -X POST http://localhost:3000/api/payment \
  -H "Content-Type: application/json" \
  -d '{"provider":"yoomoney","amount":100,"currency":"RUB"}'
```

### üåç –ü–ª–∞–Ω B (–í–Ω–µ—à–Ω–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok
npm install -g ngrok
ngrok http 3000

# –û–±–Ω–æ–≤–∏—Ç–µ .env
export YOOMONEY_NGROK_SERVER_URL="https://abc123.ngrok.io"
export YOOMONEY_REDIRECT_URI="https://abc123.ngrok.io/callback"
```

### ‚ö° –ü–ª–∞–Ω C (Production)
```bash
# –î–ª—è production —Å–µ—Ä–≤–µ—Ä–∞
export YOOMONEY_PROD_SERVER_URL="https://your-domain.com"
export YOOMONEY_REDIRECT_URI="https://your-domain.com/auth/callback"
```

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–í—Å–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –ø–æ–ª—è —Ä–µ—à–µ–Ω—ã!** üéØ

- ‚úÖ **–ê–¥—Ä–µ—Å —Å–∞–π—Ç–∞** - 3 —Ä–∞–±–æ—á–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–æ –ø–ª–∞–Ω–∞–º
- ‚úÖ **Redirect URI** - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞–Ω–∞
- ‚úÖ **Notification URI** - –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π endpoint `/webhooks/yoomoney`
- ‚úÖ **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –°–∫—Ä–∏–ø—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –ù–∞—á–Ω–∏—Ç–µ —Å **–ü–ª–∞–Ω–∞ A** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ **–ü–ª–∞–Ω—É B** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π
3. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ **–ü–ª–∞–Ω C** –¥–ª—è production

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ! üöÄ